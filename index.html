<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Registro de Eventos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            margin: 1rem;
        }

        .logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo h1 {
            color: #667eea;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .logo p {
            color: #666;
            font-size: 0.9rem;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #764ba2;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #6a4190;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .event-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .event-card h3 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .event-info {
            color: #666;
            font-size: 0.9rem;
        }

        .qr-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .qr-container canvas {
            margin: 0.5rem 0;
        }

        .qr-info {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        /* Scanner simplificado */
        .scanner-area {
            text-align: center;
            padding: 1rem;
        }

        .video-container {
            position: relative;
            margin: 1rem auto;
            width: 300px;
            height: 300px;
            border: 3px solid #667eea;
            border-radius: 15px;
            background: #f8f9fa;
            overflow: hidden;
        }

        #camera-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #667eea;
            font-size: 1.1rem;
            text-align: center;
        }

        .scan-line {
            position: absolute;
            width: 90%;
            height: 2px;
            background: #00ff00;
            left: 5%;
            animation: scan 2s linear infinite;
            display: none;
        }

        .scan-line.active {
            display: block;
        }

        @keyframes scan {
            0% { top: 10%; }
            100% { top: 85%; }
        }

        .attendee-form {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
            display: none;
        }

        .attendee-form.active {
            display: block;
        }

        .message {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .demo-section {
            margin-top: 2rem;
            padding: 1rem;
            background: #fff3e0;
            border-radius: 10px;
            border-left: 4px solid #ff9800;
        }

        @media (max-width: 600px) {
            .container {
                width: 95%;
                padding: 1.5rem;
            }
            
            .video-container {
                width: 250px;
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- P√°gina Principal -->
        <div id="homePage" class="page active">
            <div class="logo">
                <h1>üìÖ EventReg</h1>
                <p>Sistema de Registro de Eventos</p>
            </div>
            
            <button class="btn btn-primary" onclick="showPage('loginPage')">
                üë®‚Äçüíº Acceso Organizador
            </button>
            
            <button class="btn btn-secondary" onclick="showPage('attendeePage')">
                üë• Soy Asistente
            </button>
        </div>

        <!-- Login Organizador -->
        <div id="loginPage" class="page">
            <button class="back-btn" onclick="showPage('homePage')">‚Üê Volver</button>
            
            <div class="logo">
                <h1>Iniciar Sesi√≥n</h1>
                <p>Organizador</p>
            </div>
            
            <div class="form-group">
                <label for="username">Usuario:</label>
                <input type="text" id="username" required>
            </div>
            
            <div class="form-group">
                <label for="password">Contrase√±a:</label>
                <input type="password" id="password" required>
            </div>
            
            <button type="button" class="btn btn-primary" onclick="login()">Entrar</button>
            
            <div id="loginMessage" class="message" style="display: none;"></div>
        </div>

        <!-- Panel Organizador -->
        <div id="organizerPanel" class="page">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h1>Panel Organizador</h1>
                <button class="back-btn" onclick="logout()">Cerrar Sesi√≥n</button>
            </div>
            
            <button class="btn btn-primary" onclick="showPage('createEventPage')">
                ‚ûï Crear Evento
            </button>
            
            <button class="btn btn-secondary" onclick="showPage('viewEventsPage')">
                üìã Ver Eventos
            </button>
        </div>

        <!-- Crear Evento -->
        <div id="createEventPage" class="page">
            <button class="back-btn" onclick="showPage('organizerPanel')">‚Üê Volver</button>
            
            <h1>Crear Evento</h1>
            
            <div class="form-group">
                <label for="eventName">Nombre del Evento:</label>
                <input type="text" id="eventName" required>
            </div>
            
            <div class="form-group">
                <label for="eventDay">D√≠a de la Semana:</label>
                <select id="eventDay" required>
                    <option value="">Seleccionar d√≠a</option>
                    <option value="1">Lunes</option>
                    <option value="2">Martes</option>
                    <option value="3">Mi√©rcoles</option>
                    <option value="4">Jueves</option>
                    <option value="5">Viernes</option>
                    <option value="6">S√°bado</option>
                    <option value="0">Domingo</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="eventTime">Hora:</label>
                <input type="time" id="eventTime" required>
            </div>
            
            <div class="form-group">
                <label for="eventLocation">Ubicaci√≥n:</label>
                <input type="text" id="eventLocation" required>
            </div>
            
            <button type="button" class="btn btn-success" onclick="createEvent()">Crear Evento</button>
            
            <div id="createMessage" class="message" style="display: none;"></div>
        </div>

        <!-- Ver Eventos -->
        <div id="viewEventsPage" class="page">
            <button class="back-btn" onclick="showPage('organizerPanel')">‚Üê Volver</button>
            
            <h1>Eventos Programados</h1>
            
            <div id="eventsList">
                <!-- Los eventos se cargar√°n aqu√≠ -->
            </div>
        </div>

        <!-- P√°gina Asistente -->
        <div id="attendeePage" class="page">
            <button class="back-btn" onclick="showPage('homePage')">‚Üê Volver</button>
            
            <div class="logo">
                <h1>Registro de Asistente</h1>
                <p>Escanea el c√≥digo QR del evento</p>
            </div>
            
            <div class="scanner-area">
                <div class="video-container">
                    <video id="camera-video" playsinline></video>
                    <div class="camera-placeholder">
                        üì±<br>
                        Presiona "Iniciar Esc√°ner"<br>
                        para comenzar
                    </div>
                    <div class="scan-line"></div>
                </div>
                
                <button class="btn btn-primary" onclick="startScanner()" id="scanBtn">
                    üì∑ Iniciar Esc√°ner
                </button>
                <button class="btn btn-secondary" onclick="stopScanner()" id="stopBtn" style="display: none;">
                    ‚èπÔ∏è Detener
                </button>
            </div>

            <!-- Demo Section -->
            <div class="demo-section">
                <h4 style="color: #f57c00; text-align: center; margin-bottom: 1rem;">üîß Modo Demo</h4>
                <div class="form-group">
                    <label for="eventSelect">Selecciona un evento:</label>
                    <select id="eventSelect">
                        <option value="">-- Selecciona --</option>
                    </select>
                </div>
                <button class="btn btn-secondary" onclick="simulateScan()">
                    üîç Simular Escaneo
                </button>
            </div>
            
            <!-- Formulario de Asistente -->
            <div id="attendeeForm" class="attendee-form">
                <h3>üìù Registro de Asistencia</h3>
                <div id="eventDetails"></div>
                <div class="form-group">
                    <label for="attendeeName">Nombre completo:</label>
                    <input type="text" id="attendeeName" required>
                </div>
                <div class="form-group">
                    <label for="attendeeEmail">Email (opcional):</label>
                    <input type="email" id="attendeeEmail">
                </div>
                <button class="btn btn-success" onclick="confirmAttendance()">
                    ‚úÖ Confirmar Asistencia
                </button>
                <button class="btn btn-secondary" onclick="cancelRegistration()">
                    ‚ùå Cancelar
                </button>
            </div>
            
            <div id="scanMessage" class="message" style="display: none;"></div>
        </div>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

    <script>
        // Variables globales
        let events = [];
        let isLoggedIn = false;
        let videoStream = null;
        let isScanning = false;
        let currentEvent = null;
        let scanInterval = null;

        // Datos de ejemplo (simulando base de datos)
        const sampleEvents = [
            {
                id: 'event-001',
                name: 'Reuni√≥n de Equipo',
                day: 1, // Lunes
                time: '10:00',
                location: 'Sala A'
            },
            {
                id: 'event-002',
                name: 'Presentaci√≥n del Proyecto',
                day: 3, // Mi√©rcoles
                time: '14:30',
                location: 'Auditorio'
            }
        ];

        // Credenciales de ejemplo
        const adminCredentials = {
            username: 'admin',
            password: '123456'
        };

        // Funciones de utilidad
        function showPage(pageId) {
            // Ocultar todas las p√°ginas
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Mostrar p√°gina espec√≠fica
            document.getElementById(pageId).classList.add('active');
            
            // Cargar datos seg√∫n la p√°gina
            if (pageId === 'viewEventsPage') {
                loadEvents();
            } else if (pageId === 'attendeePage') {
                loadEventSelector();
            }
        }

        function showMessage(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `message ${type}`;
            element.style.display = 'block';
            
            // Auto-ocultar despu√©s de 3 segundos
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }

        // Funciones de autenticaci√≥n
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showMessage('loginMessage', 'Por favor completa todos los campos', 'error');
                return;
            }
            
            if (username === adminCredentials.username && password === adminCredentials.password) {
                isLoggedIn = true;
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                showPage('organizerPanel');
            } else {
                showMessage('loginMessage', 'Usuario o contrase√±a incorrectos', 'error');
            }
        }

        function logout() {
            isLoggedIn = false;
            showPage('homePage');
        }

        // Funciones de eventos
        function createEvent() {
            const name = document.getElementById('eventName').value;
            const day = document.getElementById('eventDay').value;
            const time = document.getElementById('eventTime').value;
            const location = document.getElementById('eventLocation').value;
            
            if (!name || !day || !time || !location) {
                showMessage('createMessage', 'Por favor completa todos los campos', 'error');
                return;
            }
            
            const newEvent = {
                id: 'event-' + Date.now(),
                name: name,
                day: parseInt(day),
                time: time,
                location: location
            };
            
            events.push(newEvent);
            
            // Limpiar formulario
            document.getElementById('eventName').value = '';
            document.getElementById('eventDay').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventLocation').value = '';
            
            showMessage('createMessage', '¬°Evento creado exitosamente!', 'success');
        }

        function loadEvents() {
            const eventsList = document.getElementById('eventsList');
            const daysOfWeek = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];
            
            // Usar eventos de muestra si no hay eventos creados
            const allEvents = events.length > 0 ? events : sampleEvents;
            
            if (allEvents.length === 0) {
                eventsList.innerHTML = '<p style="text-align: center; color: #666;">No hay eventos programados</p>';
                return;
            }
            
            eventsList.innerHTML = allEvents.map(event => `
                <div class="event-card">
                    <h3>${event.name}</h3>
                    <div class="event-info">
                        <p><strong>üìÖ D√≠a:</strong> ${daysOfWeek[event.day]}</p>
                        <p><strong>‚è∞ Hora:</strong> ${event.time}</p>
                        <p><strong>üìç Ubicaci√≥n:</strong> ${event.location}</p>
                        <p><strong>ID:</strong> ${event.id}</p>
                    </div>
                    <div class="qr-container">
                        <canvas id="qr-${event.id}" width="150" height="150"></canvas>
                        <div class="qr-info">C√≥digo QR para registro</div>
                    </div>
                    <button class="btn btn-danger" onclick="deleteEvent('${event.id}')">
                        üóëÔ∏è Eliminar
                    </button>
                </div>
            `).join('');
            
            // Generar c√≥digos QR
            setTimeout(() => {
                allEvents.forEach(event => generateQR(event));
            }, 100);
        }

        function generateQR(event) {
            const canvas = document.getElementById(`qr-${event.id}`);
            if (!canvas) return;
            
            // Datos simples para el QR
            const qrData = event.id;
            
            try {
                const qr = new QRious({
                    element: canvas,
                    value: qrData,
                    size: 150,
                    background: 'white',
                    foreground: 'black'
                });
            } catch (error) {
                console.error('Error generando QR:', error);
            }
        }

        function deleteEvent(eventId) {
            if (!confirm('¬øEst√°s seguro de eliminar este evento?')) return;
            
            events = events.filter(event => event.id !== eventId);
            loadEvents();
        }

        // Funciones del esc√°ner
        function loadEventSelector() {
            const select = document.getElementById('eventSelect');
            const allEvents = events.length > 0 ? events : sampleEvents;
            const daysOfWeek = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];
            
            select.innerHTML = '<option value="">-- Selecciona --</option>';
            
            allEvents.forEach(event => {
                const option = document.createElement('option');
                option.value = event.id;
                option.textContent = `${event.name} - ${daysOfWeek[event.day]} ${event.time}`;
                select.appendChild(option);
            });
        }

        async function startScanner() {
            const video = document.getElementById('camera-video');
            const placeholder = document.querySelector('.camera-placeholder');
            const scanLine = document.querySelector('.scan-line');
            const scanBtn = document.getElementById('scanBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            try {
                // Solicitar acceso a la c√°mara
                videoStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                video.srcObject = videoStream;
                video.play();
                
                // Mostrar video y elementos del esc√°ner
                placeholder.style.display = 'none';
                video.style.display = 'block';
                scanLine.classList.add('active');
                
                scanBtn.style.display = 'none';
                stopBtn.style.display = 'inline-block';
                
                isScanning = true;
                startQRDetection();
                
            } catch (error) {
                console.error('Error accediendo a la c√°mara:', error);
                showMessage('scanMessage', 'No se pudo acceder a la c√°mara. Usa el modo demo.', 'error');
            }
        }

        function stopScanner() {
            const video = document.getElementById('camera-video');
            const placeholder = document.querySelector('.camera-placeholder');
            const scanLine = document.querySelector('.scan-line');
            const scanBtn = document.getElementById('scanBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            isScanning = false;
            
            if (scanInterval) {
                clearInterval(scanInterval);
                scanInterval = null;
            }
            
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
            }
            
            video.style.display = 'none';
            placeholder.style.display = 'block';
            scanLine.classList.remove('active');
            
            scanBtn.style.display = 'inline-block';
            stopBtn.style.display = 'none';
        }

        function startQRDetection() {
            // Simulaci√≥n simple de detecci√≥n QR cada 2 segundos
            scanInterval = setInterval(() => {
                if (!isScanning) return;
                
                // En una implementaci√≥n real, aqu√≠ procesar√≠as los frames del video
                console.log('Buscando c√≥digos QR...');
            }, 2000);
        }

        function simulateScan() {
            const eventSelect = document.getElementById('eventSelect');
            const selectedEventId = eventSelect.value;
            
            if (!selectedEventId) {
                showMessage('scanMessage', 'Por favor selecciona un evento', 'error');
                return;
            }
            
            processQRCode(selectedEventId);
        }

        function processQRCode(eventId) {
            console.log('Procesando c√≥digo QR:', eventId);
            
            const allEvents = events.length > 0 ? events : sampleEvents;
            const event = allEvents.find(e => e.id === eventId);
            
            if (!event) {
                showMessage('scanMessage', 'Evento no encontrado', 'error');
                return;
            }
            
            // Verificar si es un buen momento para el registro
            const now = new Date();
            const currentDay = now.getDay();
            const isCorrectDay = currentDay === event.day;
            
            if (!isCorrectDay) {
                const daysOfWeek = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];
                showMessage('scanMessage', 
                    `Este evento es los ${daysOfWeek[event.day]}s. Hoy es ${daysOfWeek[currentDay]}.`, 
                    'error');
                return;
            }
            
            // Mostrar formulario de registro
            currentEvent = event;
            showRegistrationForm(event);
        }

        function showRegistrationForm(event) {
            const form = document.getElementById('attendeeForm');
            const details = document.getElementById('eventDetails');
            const daysOfWeek = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];
            
            details.innerHTML = `
                <h4>üéØ ${event.name}</h4>
                <p><strong>üìç</strong> ${event.location}</p>
                <p><strong>‚è∞</strong> ${event.time}</p>
                <p><strong>üìÖ</strong> ${daysOfWeek[event.day]}s</p>
            `;
            
            form.classList.add('active');
            document.getElementById('attendeeName').focus();
        }

        function confirmAttendance() {
            const name = document.getElementById('attendeeName').value.trim();
            const email = document.getElementById('attendeeEmail').value.trim();
            
            if (!name) {
                alert('Por favor ingresa tu nombre');
                return;
            }
            
            if (!currentEvent) {
                alert('Error: No hay evento seleccionado');
                return;
            }
            
            // Registrar asistencia (en una app real, esto se guardar√≠a en base de datos)
            const attendance = {
                eventId: currentEvent.id,
                eventName: currentEvent.name,
                attendeeName: name,
                attendeeEmail: email || null,
                timestamp: new Date().toLocaleString()
            };
            
            console.log('Asistencia registrada:', attendance);
            
            showMessage('scanMessage', 
                `¬°Registro exitoso! Bienvenido ${name} a ${currentEvent.name}`, 
                'success');
            
            cancelRegistration();
        }

        function cancelRegistration() {
            document.getElementById('attendeeForm').classList.remove('active');
            document.getElementById('attendeeName').value = '';
            document.getElementById('attendeeEmail').value = '';
            currentEvent = null;
        }

        // Inicializaci√≥n
        window.addEventListener('load', function() {
            console.log('Sistema iniciado correctamente');
            
            // Cargar eventos de muestra
            events = [...sampleEvents];
            
            // Event listeners para Enter en login
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
        });
    </script>
</body>
</html>
